<main class="flex-grow-1">
  <section class="d-flex justify-content-between" role="region" aria-label="Game scores">
    <div role="status" aria-live="polite" aria-atomic="true">
      <div id="round-label" class="score-label">Round Score</div>
      <div aria-labelledby="round-label">
        <span>{{ earnedPoints$ | async | number }}</span>/<span class="points">{{ potentialPoints$ | async | number }}</span>
      </div>
    </div>
    <div role="status" aria-live="polite" aria-atomic="true">
      <div id="total-label" class="score-label">Total Score</div>
      <div class="points text-align-right" aria-labelledby="total-label">{{
        score$ | async | number
      }}</div>
    </div>
  </section>

  <section
    class="flex-center hori-scroll answers-container"
    role="region"
    aria-label="Word answers"
  >
    @let recentAnswer = mostRecentAnswer$ | async; 
    @for (answer of answers$ | async; track answer.word; let i = $index) { 
      @if (i > 0) {
        <span class="word-separator" aria-hidden="true">â€¢</span>
      }
      <div
        class="flex-center word"
        [id]="answer.word"
        role="group"
        [attr.aria-label]="
          answer.state === 'not-found'
            ? 'Unfound word with ' + answer.letters.length + ' letters'
            : 'Found word: ' + answer.word
        "
        [class.word-found]="answer.state === 'found'"
        [class.word-revealed]="answer.state === 'revealed'"
      >
      @for (letter of answer.letters; track $index; let letterIndex = $index) {
        <span
          class="letter"
          aria-hidden="true"
          [class.letter-drop]="shouldAnimateLetter(answer, recentAnswer)"
          [style.animation-delay.ms]="
            getLetterAnimationDelay(answer, letterIndex, recentAnswer)
          "
        >
          {{ answer.state === "not-found" ? "_" : letter }}
        </span>
      }
    </div>
  }
  </section>

  <section
    class="flex-center-center letter-button-container"
    role="region"
    aria-label="Selected letters"
  >
    @for (letter of clickedLetters$ | async; track trackByLetterIndexValue($index, letter)) {
      <button
        mat-raised-button
        (click)="clickLetter(letter)"
        [attr.aria-label]="'Remove letter ' + letter.value"
      >
        {{ letter.value }}
      </button>
    }
  </section>

  <section
    class="flex-center-center letter-button-container"
    role="region"
    aria-label="Available letters"
  >
    @for (letter of clickableLetters$ | async; track trackByLetterIndexValue($index, letter)) {
      <button
        mat-raised-button
        (click)="clickLetter(letter)"
        [attr.aria-label]="'Select letter ' + letter.value"
      >
        {{ letter.value }}
      </button>
    }
  </section>

  @if ({ isOver: isGameOver$ | async }; as vm) {
    <section class="flex-center-between" role="region" aria-label="Game controls">
      <button
        mat-raised-button
        [disabled]="vm.isOver"
        (click)="clickShuffle()"
        [attr.aria-label]="
          vm.isOver
            ? 'Shuffle letters (disabled - game over)'
            : 'Shuffle available letters'
        "
        [attr.aria-disabled]="vm.isOver"
      >
        <mat-icon aria-hidden="true">shuffle</mat-icon>
        Shuffle
      </button>
      <button
        mat-raised-button
        [color]="vm.isOver ? 'accent' : 'primary'"
        (click)="clickEnter(!!vm.isOver)"
        [attr.aria-label]="
          vm.isOver ? 'Start a new game' : 'Submit current word'
        "
      >
        @if (vm.isOver) {
          <mat-icon aria-hidden="true">refresh</mat-icon>
        } @else {
          <mat-icon aria-hidden="true">send</mat-icon>
        }
        {{ vm.isOver ? "Start New Game" : "Enter" }}
      </button>
    </section>
  }
</main>
